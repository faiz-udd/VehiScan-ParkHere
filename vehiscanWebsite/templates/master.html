{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-100">
  <head>
    <title>{% block title %}VehiScan{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
      html, body {
        height: 100%;
      }
      body {
        font-family: 'Roboto', Arial, sans-serif; 
        background: #f8f9fa;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      main {
        margin-bottom:10%;
        flex: 1 0 auto; /* This makes the main content area grow to push the footer down */
      }
      h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', Arial, sans-serif; }
      .navbar { background: #fff !important; box-shadow: 0 2px 8px rgba(44,184,243,0.04); }
      .navbar-brand { color: #2dc98a !important; font-weight: bold; font-size: 1.6rem; letter-spacing: 1px; }
      .nav-link, .navbar-nav .nav-link { color: #222 !important; font-weight: 500; }
      .nav-link.active, .nav-link:focus, .nav-link:hover { color: #2dc98a !important; }
      .btn-primary, .bg-primary { background-color: #2dc98a !important; border: none; }
      .btn-primary:hover { background-color: #1fa06b !important; }
      .btn-outline-primary { border-color: #2dc98a !important; color: #2dc98a !important; }
      .btn-outline-primary:hover { background: #2dc98a !important; color: #fff !important; }
      .btn-secondary { background: #44b8f3 !important; border: none; }
      .btn-secondary:hover { background: #2196c9 !important; }
      .footer {
        background: #060606;
        color: #fff;
        padding: 2.5rem 0 1.2rem 0;
        flex-shrink: 0; /* Prevent the footer from shrinking */
        width: 100%;
      }
      .footer a { color: #44b8f3; text-decoration: none; }
      .footer a:hover { color: #2dc98a; }
      .newsletter-input { border-radius: 2rem; border: none; padding: 0.7rem 1.2rem; }
      .newsletter-btn { border-radius: 2rem; background: #44b8f3; color:black; font-weight: 600; }
      @media (max-width: 767px) {
        .navbar-brand { font-size: 1.4rem; }
        .footer {
          text-align: center;
        }
        .footer .col-md-3, .footer .col-md-4, .footer .col-md-2 {
          margin-bottom: 2rem;
        }
        .footer .d-flex.gap-3 {
          justify-content: center;
        }
      }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body class="d-flex flex-column min-vh-100">
    <!-- Modern Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
      <div class="container">
        <a class="navbar-brand" href="/">VehiScan</a>
        <!-- Add the missing button opening tag -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainNav">
          <ul class="navbar-nav ms-auto align-items-lg-center">
            <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'home' %}#features">Features</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'home' %}#how">How It Works</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'home' %}#owner">Register</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'parking-lot-monitors' %}">Search</a></li>
            {% if user.is_authenticated %}
              <li class="nav-item"><a href="{% url 'account' %}" class="btn btn-outline-primary ms-lg-3 my-2 my-lg-0">Account</a></li>
              {% if user.profile.user_type == 'lot_owner' %}
                <li class="nav-item"><a href="{% url 'create_listing' %}" class="btn btn-secondary ms-lg-3 my-2 my-lg-0">Add Parking</a></li>
              {% endif %}
            {% else %}
              <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Sign In</a></li>
              <li class="nav-item"><a class="btn btn-primary ms-lg-2 my-2 my-lg-0" href="{% url 'register-user' %}">Sign Up</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    
    <!-- Main Content -->
    <main class="container-fluid px-0 flex-grow-1">
      {% block main %}{% endblock %}
    </main>
    
    <!-- Modern Footer -->
    <footer class="footer mt-auto">
      <div class="container">
        <div class="row mb-4">
          <div class="col-md-4 mb-3 mb-md-0">
            <h5>About VehiScan</h5>
            <p>VehiScan is a smart parking platform using AI to help drivers and lot owners find, manage, and optimize parking in real time.</p>
          </div>
          <div class="col-md-2 mb-3 mb-md-0">
            <h5>Links</h5>
            <ul class="list-unstyled">
              <li><a href="#">About Us</a></li>
              <li><a href="{% url 'home' %}#contact">Contact</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="{% url 'privacy-policy' %}">Privacy Policy</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-md-3 mb-3 mb-md-0">
            <h5>Newsletter</h5>
            <form class="d-flex">
              <input type="email" class="form-control newsletter-input me-2" placeholder="Your email">
              <button class="btn newsletter-btn bg-light" type="submit">Subscribe</button>
            </form>
          </div>
          <div class="col-md-3">
            <h5>Follow Us</h5>
            <div class="d-flex gap-3">
              <a href="#"><i class="fab fa-facebook fa-2x"></i></a>
              <a href="#"><i class="fab fa-instagram fa-2x"></i></a>
              <a href="#"><i class="fab fa-linkedin fa-2x"></i></a>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col text-center">
            <small>&copy; 2025 VehiScan. All rights reserved.</small>
          </div>
        </div>
      </div>
    </footer>
    
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 11"></div>
    {% block scripts %}{% endblock %}
    <script>
      // Process Django messages and convert them to toasts
      document.addEventListener('DOMContentLoaded', function() {
        // Function to create and show toast
        function showToast(message, type) {
          const toastContainer = document.querySelector('.toast-container');
          
          // Create unique ID for this toast
          const toastId = 'toast-' + Date.now();
          
          // Set icon based on message type
          let icon = 'info-circle';
          let bgClass = 'bg-info';
          
          if (type === 'success') {
            icon = 'check-circle';
            bgClass = 'bg-success';
          } else if (type === 'error' || type === 'danger') {
            icon = 'exclamation-circle';
            bgClass = 'bg-danger';
          } else if (type === 'warning') {
            icon = 'exclamation-triangle';
            bgClass = 'bg-warning';
          }
          
          // Create toast HTML
          const toastHtml = `
            <div id="${toastId}" class="toast text-white ${bgClass}" role="alert" aria-live="assertive" aria-atomic="true">
              <div class="toast-header ${bgClass} text-white">
                <i class="fas fa-${icon} me-2"></i>
                <strong class="me-auto">${type === 'success' ? 'Success' : type === 'error' ? 'Error' : 'Message'}</strong>
                <small>Just now</small>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
              <div class="toast-body">
                ${message}
              </div>
            </div>
          `;
          
          // Add toast to container
          toastContainer.insertAdjacentHTML('beforeend', toastHtml);
          
          // Initialize and show toast
          const toastElement = document.getElementById(toastId);
          const toast = new bootstrap.Toast(toastElement, {
            autohide: true,
            delay: 5000
          });
          toast.show();
          
          // Remove toast from DOM after it's hidden
          toastElement.addEventListener('hidden.bs.toast', function() {
            toastElement.remove();
          });
        }
        
        // Process Django messages if any
        {% if messages %}
          {% for message in messages %}
            showToast("{{ message }}", "{{ message.tags }}");
          {% endfor %}
        {% endif %}
        
        // Check URL for message parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('message')) {
          const message = urlParams.get('message');
          const type = urlParams.get('type') || 'info';
          showToast(decodeURIComponent(message), type);
        }
      });
    </script>
  </body>
</html>